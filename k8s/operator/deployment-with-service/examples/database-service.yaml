apiVersion: apps.example.com/v1
kind: Service
metadata:
  name: postgres-db
  namespace: default
spec:
  image: postgres:13
  replicas: 1
  port: 5432
  serviceType: ClusterIP
  configData:
    postgresql.conf: |
      # PostgreSQL configuration
      max_connections = 100
      shared_buffers = 128MB
      effective_cache_size = 4GB
      maintenance_work_mem = 64MB
      checkpoint_completion_target = 0.9
      wal_buffers = 16MB
      default_statistics_target = 100
      random_page_cost = 1.1
      effective_io_concurrency = 200
  env:
    - name: POSTGRES_DB
      value: "myapp"
    - name: POSTGRES_USER
      value: "myuser"
    - name: POSTGRES_PASSWORD
      value: "mypassword"
    - name: PGDATA
      value: "/var/lib/postgresql/data/pgdata"
  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "1000m"
      memory: "2Gi"