# 日报工具集成测试指南

本文档提供了日报工具的手动测试指南，用于验证自动化测试无法覆盖的功能。

## 自动化测试覆盖

以下功能已通过自动化集成测试验证（运行 `go test ./internal/integration/...`）：

- ✅ 任务创建、编辑和保存流程
- ✅ 日历日期查询功能
- ✅ 配置管理和验证
- ✅ 提醒服务启动和停止
- ✅ 错误处理和数据持久化

## 手动测试场景

### 1. UI 交互测试

#### 1.1 日历视图测试

**测试步骤：**
1. 启动应用程序：`.\daily-report.exe`
2. 验证日历显示当前月份
3. 点击"上一月"按钮，验证日历切换到上个月
4. 点击"下一月"按钮，验证日历切换到下个月
5. 创建几个不同日期的任务
6. 验证有任务的日期显示蓝色标记

**预期结果：**
- 日历正确显示月份和日期
- 月份导航按钮工作正常
- 有任务的日期显示蓝色背景标识

#### 1.2 任务编辑测试

**测试步骤：**
1. 在日历中选择一个日期
2. 在编辑器中输入以下 Markdown 内容：
```markdown
# 今日工作

## 完成的任务
- 完成需求文档
- 代码评审
- 编写测试用例

## 明日计划
- 继续开发新功能
- 修复 Bug
```
3. 等待 2 秒（自动保存）
4. 切换到另一个日期
5. 切换回原日期
6. 验证内容已保存

**预期结果：**
- 编辑器可以正常输入文本
- 内容在 2 秒后自动保存
- 切换日期后内容正确加载

#### 1.3 Markdown 预览测试

**测试步骤：**
1. 在编辑器中输入各种 Markdown 语法：
   - 标题（# ## ###）
   - 列表（- * 1.）
   - 粗体（**文本**）
   - 斜体（*文本*）
   - 代码块（```）
   - 链接（[文本](URL)）
2. 观察右侧预览区域

**预期结果：**
- 预览区域实时更新
- Markdown 语法正确渲染为 HTML
- 格式显示正确

#### 1.4 设置界面测试

**测试步骤：**
1. 点击菜单栏"文件" -> "设置"
2. 输入企业微信 Webhook URL（可以使用测试 URL）
3. 设置提醒时间（例如：14:30）
4. 勾选"启用提醒"复选框
5. 点击"保存"按钮
6. 重新打开设置界面
7. 验证配置已保存

**预期结果：**
- 设置窗口正确显示
- 配置保存成功
- 重新打开后配置正确显示

### 2. 提醒服务定时触发测试

由于提醒服务基于系统时间触发，需要通过修改系统时间来验证。

#### 2.1 提醒触发测试

**测试步骤：**
1. 配置企业微信 Webhook URL（使用真实的或测试的 Webhook）
2. 设置提醒时间为当前时间后 2 分钟（例如：当前 14:28，设置为 14:30）
3. 启用提醒
4. 确保今天没有创建任务
5. 等待到达提醒时间
6. 检查企业微信是否收到提醒消息

**预期结果：**
- 到达设定时间时，企业微信收到提醒消息
- 消息内容为："提醒：您今天还没有填写日报，请及时记录工作内容。"
- 日志文件记录提醒发送成功

#### 2.2 已有任务时不提醒测试

**测试步骤：**
1. 配置提醒服务（同上）
2. 创建今天的任务
3. 等待到达提醒时间
4. 验证不会收到提醒消息

**预期结果：**
- 今天已有任务时，不发送提醒
- 日志记录"今天已有任务，不需要提醒"

#### 2.3 防重复发送测试

**测试步骤：**
1. 配置提醒服务
2. 确保今天没有任务
3. 等待到达提醒时间，收到第一次提醒
4. 继续等待（提醒服务每分钟检查一次）
5. 验证不会收到第二次提醒

**预期结果：**
- 每天只发送一次提醒
- 日志记录"今天已发送过提醒，跳过"

### 3. 错误处理验证

#### 3.1 无效 Webhook URL 测试

**测试步骤：**
1. 打开设置界面
2. 输入无效的 Webhook URL：
   - 空 URL
   - 格式错误的 URL（例如：not-a-url）
   - 缺少 key 参数的企业微信 URL
3. 点击保存

**预期结果：**
- 显示错误提示对话框
- 配置不会保存
- 错误消息清晰说明问题

#### 3.2 无效时间格式测试

**测试步骤：**
1. 打开设置界面
2. 输入无效的时间格式：
   - 25:00
   - 12:60
   - abc
3. 点击保存

**预期结果：**
- 显示错误提示
- 提示正确的时间格式（HH:MM）

#### 3.3 文件系统错误测试

**测试步骤：**
1. 找到数据目录（默认：./data/tasks）
2. 将某个任务文件设置为只读
3. 尝试编辑该日期的任务
4. 观察错误处理

**预期结果：**
- 显示用户友好的错误对话框
- 错误消息说明无法保存文件
- 应用程序不会崩溃

### 4. Windows 兼容性测试

#### 4.1 Windows 10 测试

**测试环境：**
- 操作系统：Windows 10（版本 1909 或更高）
- 架构：64 位

**测试步骤：**
1. 双击 `daily-report.exe` 启动应用
2. 验证窗口正常显示
3. 执行上述所有 UI 交互测试
4. 验证文件读写功能正常
5. 验证提醒服务正常工作

**预期结果：**
- 应用程序正常启动，无控制台窗口
- 所有功能正常工作
- 界面显示正常，无乱码

#### 4.2 Windows 11 测试

**测试环境：**
- 操作系统：Windows 11
- 架构：64 位

**测试步骤：**
1. 双击 `daily-report.exe` 启动应用
2. 验证窗口正常显示（Windows 11 新 UI 风格）
3. 执行上述所有 UI 交互测试
4. 验证文件读写功能正常
5. 验证提醒服务正常工作

**预期结果：**
- 应用程序正常启动
- 界面适配 Windows 11 风格
- 所有功能正常工作

#### 4.3 首次运行测试

**测试步骤：**
1. 删除 config 和 data 目录
2. 启动应用程序
3. 验证自动创建默认配置
4. 验证自动创建数据目录
5. 验证应用程序正常工作

**预期结果：**
- 自动创建 config/config.json（默认配置）
- 自动创建 data/tasks 目录
- 应用程序正常启动和运行

### 5. 日志验证

#### 5.1 日志文件检查

**测试步骤：**
1. 运行应用程序并执行各种操作
2. 打开日志文件：`logs/app.log`
3. 检查日志内容

**预期结果：**
- 日志文件存在且可读
- 日志包含不同级别（INFO、WARN、ERROR、DEBUG）
- 关键操作都有日志记录：
  - 应用启动
  - 任务保存
  - 配置更新
  - 提醒发送
  - 错误信息

#### 5.2 错误日志验证

**测试步骤：**
1. 故意触发各种错误（无效配置、文件权限等）
2. 检查日志文件中的错误记录

**预期结果：**
- 所有错误都被记录到日志
- 错误信息包含足够的上下文
- 错误堆栈信息完整

## 性能测试

### 6.1 大量任务测试

**测试步骤：**
1. 创建 100+ 个不同日期的任务
2. 在日历中导航不同月份
3. 观察响应速度

**预期结果：**
- 日历导航流畅，无明显延迟
- 任务加载快速（< 1 秒）
- 内存使用合理

### 6.2 长文本测试

**测试步骤：**
1. 在编辑器中输入大量文本（5000+ 字）
2. 观察编辑器和预览的响应
3. 保存并重新加载

**预期结果：**
- 编辑器输入流畅
- 预览更新及时
- 保存和加载正常

## 测试检查清单

使用以下检查清单确保所有测试都已完成：

### 自动化测试
- [x] 运行集成测试套件
- [x] 所有测试通过

### UI 测试
- [ ] 日历视图显示正确
- [ ] 日历导航功能正常
- [ ] 任务日期标记显示
- [ ] 日期选择功能正常
- [ ] 编辑器输入正常
- [ ] 自动保存功能正常
- [ ] Markdown 预览实时更新
- [ ] Markdown 语法正确渲染
- [ ] 设置界面显示正常
- [ ] 配置保存和加载正常

### 提醒服务测试
- [ ] 定时提醒触发正常
- [ ] 已有任务时不提醒
- [ ] 防重复发送机制正常
- [ ] Webhook 消息发送成功

### 错误处理测试
- [ ] 无效 URL 验证正常
- [ ] 无效时间格式验证正常
- [ ] 文件系统错误处理正常
- [ ] 错误对话框显示友好

### Windows 兼容性测试
- [ ] Windows 10 运行正常
- [ ] Windows 11 运行正常
- [ ] 首次运行初始化正常
- [ ] 无控制台窗口

### 日志测试
- [ ] 日志文件正常创建
- [ ] 日志级别正确
- [ ] 关键操作有日志记录
- [ ] 错误信息记录完整

### 性能测试
- [ ] 大量任务处理正常
- [ ] 长文本处理流畅

## 测试报告模板

完成测试后，请填写以下报告：

```
测试日期：____________________
测试人员：____________________
测试环境：
  - 操作系统：____________________
  - 系统版本：____________________
  - 应用版本：____________________

测试结果：
  - 通过的测试：____ / ____
  - 失败的测试：____ / ____
  - 跳过的测试：____ / ____

发现的问题：
1. ____________________
2. ____________________
3. ____________________

建议：
____________________
____________________
____________________

总体评价：
□ 通过 - 可以发布
□ 有问题 - 需要修复后重新测试
□ 失败 - 需要重大修改
```

## 注意事项

1. **企业微信 Webhook 测试**：建议使用测试群组的 Webhook，避免打扰正式群组
2. **系统时间修改**：测试提醒功能时修改系统时间可能影响其他应用，测试完成后记得恢复
3. **数据备份**：测试前备份重要数据，避免误删除
4. **日志清理**：定期清理测试产生的日志文件
5. **权限问题**：某些测试需要管理员权限，请以管理员身份运行

## 故障排查

### 应用无法启动
- 检查是否缺少依赖库
- 查看日志文件中的错误信息
- 验证配置文件格式是否正确

### 提醒不工作
- 检查配置中是否启用提醒
- 验证 Webhook URL 是否正确
- 查看日志中的提醒服务状态
- 确认系统时间正确

### 任务无法保存
- 检查数据目录权限
- 验证磁盘空间是否充足
- 查看日志中的错误信息

### 界面显示异常
- 尝试调整窗口大小
- 重启应用程序
- 检查系统 DPI 设置
